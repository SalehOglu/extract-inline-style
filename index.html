<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/x-icon" href="/src/imgs/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/src/css/style.css">
    <title>Extract inline style from HTML</title>
</head>
<body>

    <div class="wrapper">
        <div class="inner">
            <h1>Upload Your HTML Files</h1>
            <img src="/src/imgs/upload.png" alt="Icon"/>
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="fileupload">
                    <input type="file" id="fileInput" class="file-input" accept=".html" multiple required/>
                    <label for="fileInput" class="fileLabel">Choose a file</label>
                </div>
                <div class="selected" id="selectedFiles">
                    <span>No files chosen</span>
                </div>
                <button id="submitBtn" type="submit">Convert</button>
            </form>
            <div id="message"></div>
            <div id="downloadLinkContainer" style="display: none;">
                <a id="downloadHtmlLink" href="#" download>Download Cleaned HTML</a><br/>
                <a id="downloadCssLink" href="#" download>Download Merged CSS</a>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('fileInput');
            const selectedFilesDiv = document.getElementById('selectedFiles');
            const convertButton = document.getElementById('submitBtn');


            document.getElementById('uploadForm').addEventListener('submit', function(event) {
                event.preventDefault();

                convertButton.textContent = 'Converting..';
                convertButton.classList.add("loading");

                const formData = new FormData();

                // Loop through all selected files and append them to FormData
                for (let i = 0; i < fileInput.files.length; i++) {
                    formData.append('files[]', fileInput.files[i]); // Use 'files[]' to indicate multiple files
                }

                fetch('/upload', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    let msg = document.getElementById('message');
                    msg.textContent = data.message;
                    msg.classList.add("active");
                    // Show the download link
                    if (data.downloadHtmlUrl && data.downloadCssUrl) {
            console.log("Download URLs received:", data.downloadHtmlUrl, data.downloadCssUrl); // Debug
            const downloadLinkContainer = document.getElementById('downloadLinkContainer');
            const downloadHtmlLink = document.getElementById('downloadHtmlLink');
            const downloadCssLink = document.getElementById('downloadCssLink');

            downloadHtmlLink.href = data.downloadHtmlUrl;
            downloadCssLink.href = data.downloadCssUrl;
            downloadLinkContainer.style.display = 'block';
        } else {
            console.log("Download URLs missing in response"); // Debug
        }

                    // Reset button text and state on success
                    convertButton.textContent = 'Convert';
                    convertButton.classList.remove("loading");
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            });

            // Update the div to show the selected file names
            fileInput.addEventListener('change', function(event) {
                const fileNames = Array.from(event.target.files).map(file => file.name).join(', ');
                selectedFilesDiv.textContent = fileNames || 'No files chosen'; // Update the div with selected file names or reset to default

                // Show the convert button only if files are selected
                if (fileInput.files.length > 0) {
                    convertButton.style.display = 'block';
                } else {
                    convertButton.style.display = 'none';
                }
                
            });
        });
    </script>
</body>
</html>
